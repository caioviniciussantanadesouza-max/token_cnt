<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CNT — Reserva Ambiental Tokenizada</title>

<style>
:root{
  --bg:#05080a;
  --hud: rgba(110,210,255,.95);
  --stroke: rgba(110,210,255,.18);
  --glass: rgba(2,10,16,.44);
  --glass2: rgba(2,10,16,.26);
  --text:#d7fbff;
  --muted:#9fe9ff;
  --shadow: 0 0 22px rgba(110,210,255,.12), 0 0 90px rgba(0,200,255,.06);
  --inner: inset 0 0 28px rgba(0,0,0,.42);
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:"Segoe UI",system-ui,Arial,sans-serif;overflow:hidden}

#stage{position:fixed;inset:0;background:radial-gradient(circle at 40% 35%, rgba(60,140,170,.18), transparent 55%),
radial-gradient(circle at 75% 65%, rgba(30,110,140,.12), transparent 55%),var(--bg);z-index:0}

.glass{background:linear-gradient(180deg,var(--glass),var(--glass2));backdrop-filter:blur(14px);border:1px solid var(--stroke);box-shadow:var(--shadow);border-radius:22px}

#top{position:fixed;left:50%;top:14px;transform:translateX(-50%);width:min(1100px,92vw);padding:14px 16px;z-index:20}
#topRow{display:flex;align-items:flex-end;gap:12px;justify-content:center;flex-wrap:wrap}
#brand{text-align:center;line-height:1}
#brand .h1{font-weight:950;letter-spacing:.9px;font-size:22px}
#brand .h2{margin-top:6px;font-size:12px;color:var(--muted);opacity:.95}
.badges{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.badge{font-size:11px;padding:7px 10px;border-radius:999px;border:1px solid rgba(110,210,255,.18);background:rgba(0,0,0,.18);color:#c7f7ff;opacity:.98}

#leftPanel{position:fixed;left:14px;top:92px;width:380px;padding:16px;z-index:15}
.small{font-size:12px;color:var(--muted);opacity:.95}
.divider{height:1px;background:linear-gradient(90deg,transparent,rgba(110,210,255,.25),transparent);margin:12px 0}
.bigScore{display:flex;align-items:flex-end;gap:8px;margin-top:10px}
.bigScore .num{font-size:82px;font-weight:250;line-height:1;color:#e7fdff}
.bigScore .unit{font-size:14px;color:rgba(220,255,255,.75);padding-bottom:10px}
.kline{display:flex;justify-content:space-between;gap:10px;margin-top:8px;font-size:12px;color:#cfefff}
.kline b{color:#eafcff}

.abclines{margin-top:10px;display:grid;gap:8px}
.barRow{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:10px 10px;border:1px solid rgba(110,210,255,.14);border-radius:14px;background:rgba(0,0,0,.16);font-size:12px}
.barRow .lab{color:#cfefff}
.barRow .val{font-weight:900;color:#eafcff}

.grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px 10px;margin-top:10px}
.kv{display:flex;justify-content:space-between;align-items:center;font-size:12px;padding:10px 10px;border:1px solid rgba(110,210,255,.14);border-radius:14px;background:rgba(0,0,0,.16);cursor:pointer;user-select:none}
.kv:hover{border-color: rgba(110,210,255,.32);box-shadow: 0 0 16px rgba(110,210,255,.18)}
.kv b{font-weight:950;letter-spacing:.4px}
.kv span{font-weight:900;color:#e9fdff}

.note{margin-top:10px;font-size:11px;color:var(--muted);opacity:.95;line-height:1.3}

#mapWrap{position:absolute;left:50%;top:88px;transform:translateX(-50%);width:min(860px,62vw);height:calc(100vh - 168px);border-radius:26px;overflow:hidden;background:rgba(0,0,0,.62);box-shadow:var(--shadow),var(--inner);border:1px solid rgba(110,210,255,.12)}
#bgMap{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;object-position:center;transform:translateY(6px) scale(.98);filter:brightness(.95) contrast(1.18) saturate(1.25);animation:mapBreath 8s ease-in-out infinite}
@keyframes mapBreath{0%{filter:brightness(.88) contrast(1.12) saturate(1.12)}50%{filter:brightness(1.10) contrast(1.30) saturate(1.38)}100%{filter:brightness(.88) contrast(1.12) saturate(1.12)}}
#mapGlow{position:absolute;inset:-10%;pointer-events:none;mix-blend-mode:screen;background:
radial-gradient(circle at 30% 45%, rgba(120,220,255,.22), transparent 55%),
radial-gradient(circle at 70% 40%, rgba(120,220,255,.12), transparent 60%),
radial-gradient(circle at 60% 75%, rgba(120,220,255,.10), transparent 60%);
filter:blur(16px);opacity:.30;animation:glowPulse 6s ease-in-out infinite}
@keyframes glowPulse{0%{opacity:.20;transform:scale(1)}50%{opacity:.42;transform:scale(1.03)}100%{opacity:.20;transform:scale(1)}}
#scanlines{position:absolute;inset:0;pointer-events:none;opacity:.18;background:repeating-linear-gradient(to bottom,rgba(120,220,255,.06) 0px,rgba(120,220,255,.06) 1px,transparent 2px,transparent 7px);mix-blend-mode:overlay;animation:scan 3s linear infinite}
@keyframes scan{0%{transform:translateY(-18px)}100%{transform:translateY(18px)}}
#holo{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;mix-blend-mode:screen;opacity:.95;filter:drop-shadow(0 0 10px rgba(110,210,255,.28))}

#rightCol{position:fixed;right:14px;top:92px;width:380px;z-index:15;display:flex;flex-direction:column;gap:12px}
#buyPanel{padding:16px}
.title{font-weight:950;letter-spacing:.8px;font-size:14px;color:#eafcff;margin-bottom:10px}
.buyDesc{font-size:12px;color:var(--muted);line-height:1.35;opacity:.95;margin-bottom:10px}
label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
input{width:180px;padding:11px 11px;border-radius:14px;border:1px solid rgba(110,210,255,.32);background:rgba(0,0,0,.18);color:#eafcff;outline:none}
input:focus{border-color: rgba(110,210,255,.65);box-shadow: 0 0 16px rgba(110,210,255,.18)}
.btn{background:linear-gradient(180deg,rgba(110,210,255,.18),rgba(0,0,0,.14));border:1px solid rgba(110,210,255,.40);color:#eafcff;border-radius:14px;padding:11px 14px;cursor:pointer;font-weight:900}
.btn:hover{box-shadow:0 0 18px rgba(110,210,255,.28)}
.valueLine{margin-top:10px;font-size:12px;color:#cfefff}
.valueLine b{font-size:18px;color:#eafcff}
.subnote{margin-top:6px;font-size:11px;color:var(--muted);opacity:.95}

#telemetry{padding:12px 14px}
#telemetryTop{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px}
#telemetryTitle{font-size:11px;letter-spacing:.9px;color:#d7fbff;opacity:.95}
#telemetryHint{font-size:11px;color:rgba(200,250,255,.75);opacity:.95}
#wave{width:100%;height:72px;display:block;border-radius:14px;background:rgba(0,0,0,.25);border:1px solid rgba(110,210,255,.14);filter:drop-shadow(0 0 10px rgba(110,210,255,.35))}

#modalOverlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);display:none;z-index:60}
#modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(540px,92vw);padding:16px;border-radius:18px;z-index:70;display:none}
#modal h3{margin:0 0 6px;letter-spacing:.6px}
#modal .mtext{color:#c9f7ff;font-size:13px;line-height:1.35}
#modal .closeRow{display:flex;justify-content:flex-end;margin-top:12px}

@media (max-width: 980px){
  body{overflow:auto}
  #leftPanel,#rightCol{position:relative;left:auto;right:auto;top:auto;width:min(92vw,720px);margin:12px auto 0}
  #mapWrap{position:relative;left:auto;top:auto;transform:none;width:min(92vw,720px);height:420px;margin:12px auto}
  #stage{position:relative;min-height:100vh}
  #top{position:relative;left:auto;transform:none;margin:12px auto}
}
</style>
</head>

<body>
<div id="stage">
  <div id="top" class="glass">
    <div id="topRow">
      <div id="brand">
        <div class="h1">CNT — Reserva Ambiental Tokenizada</div>
        <div class="h2">Ativo híbrido: conservação + monitoramento + registro público (auditável via JSON)</div>
      </div>
      <div class="badges">
        <span class="badge" id="b1">Fonte: carregando…</span>
        <span class="badge">Ano base: <span id="yearEnd">—</span></span>
        <span class="badge">A/B/C + ENT/PAN</span>
        <span class="badge">Rede: Solana</span>
        <span class="badge">Registro público</span>
      </div>
    </div>
  </div>

  <div id="leftPanel" class="glass">
    <div class="small">
      <b>CNT (Solana)</b>: participação digital numa reserva ambiental monitorada.
      Compra financia conservação + mantém auditoria pública + telemetria.
    </div>

    <div class="bigScore">
      <div class="num" id="cntA">—</div>
      <div class="unit">/100</div>
    </div>

    <div class="kline">
      <span>ECO RATING (A — Estado)</span>
      <b id="rating">—</b>
    </div>

    <div class="divider"></div>

    <div class="abclines">
      <div class="barRow"><span class="lab">A — Estado (score atual)</span><span class="val" id="Aabs">—</span></div>
      <div class="barRow"><span class="lab">B — Tendência (pontos/ano)</span><span class="val" id="Babs">—</span></div>
      <div class="barRow"><span class="lab">C — Estabilidade (σ 10y)</span><span class="val" id="Cabs">—</span></div>
    </div>

    <div class="divider"></div>

    <div class="small" style="font-weight:950; letter-spacing:.5px;">Sub-índices agregados (clique para ver)</div>
    <div class="grid2">
      <div class="kv" data-k="IBI"><b>IBI</b><span id="ibi">—</span></div>
      <div class="kv" data-k="IAB"><b>IAB</b><span id="iab">—</span></div>
      <div class="kv" data-k="HID"><b>HID</b><span id="hid">—</span></div>
      <div class="kv" data-k="PAN"><b>PAN</b><span id="pan">—</span></div>
      <div class="kv" data-k="ENT"><b>ENT</b><span id="ent">—</span></div>
      <div class="kv" data-k="REL"><b>REL</b><span id="relA">—</span></div>
    </div>

    <div class="note">
      ENT e PAN são ajustes (risco/penalidade). CNT = conservação + monitoramento + registro público.
    </div>
  </div>

  <div id="mapWrap">
    <img id="bgMap" src="mapa_br.png" alt="Mapa Brasil" />
    <canvas id="holo"></canvas>
    <div id="mapGlow"></div>
    <div id="scanlines"></div>
  </div>

  <div id="rightCol">
    <div id="buyPanel" class="glass">
      <div class="title">ADQUIRIR CNT (RESERVA AMBIENTAL)</div>
      <div class="buyDesc">
        Frações de integridade ecológica + validação temporal (telemetria) + registro público de aquisição/monitoramento.
      </div>

      <label for="sol">Contribuição em SOL</label>
      <div class="row">
        <input id="sol" type="number" step="0.01" min="0" value="0.10" />
        <button class="btn" onclick="connect()">Conectar Wallet</button>
        <button class="btn" onclick="buy()">Participar</button>
      </div>

      <div class="valueLine">
        Emissão estimada: <b id="out">— CNT</b>
      </div>
      <div class="subnote">Rede: Solana • Pump.fun (interface) • lastro = dados públicos + auditoria via JSON.</div>
    </div>

    <div id="telemetry" class="glass">
      <div id="telemetryTop">
        <div id="telemetryTitle">TELEMETRIA (JSON) — Série</div>
        <div id="telemetryHint">Carregando…</div>
      </div>
      <canvas id="wave"></canvas>
    </div>
  </div>
</div>

<div id="modalOverlay"></div>
<div id="modal" class="glass">
  <h3 id="mTitle">IBI</h3>
  <div class="mtext" id="mText"></div>
  <div class="closeRow">
    <button class="btn" id="closeBtn">Fechar</button>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const DATA_FILE = "dados_cnt.json";  // ESTE É O CERTO
const RATE_SOL_TO_CNT = 147449130;   // demo

const $ = (id)=>document.getElementById(id);
const fmt1 = (v)=> (Number.isFinite(v) ? v.toFixed(1) : "N/D");
const fmt2 = (v)=> (Number.isFinite(v) ? v.toFixed(2) : "N/D");
const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

function gradeFromA(a){
  if(!Number.isFinite(a)) return "—";
  if(a >= 85) return "AAA";
  if(a >= 75) return "AA";
  if(a >= 65) return "A";
  if(a >= 55) return "BBB";
  if(a >= 45) return "BB";
  if(a >= 35) return "B";
  if(a >= 25) return "C";
  return "D";
}

/* ===== Carregar dados_cnt.json ===== */
let series = null;

async function carregarDadosReais(){
  try{
    const res = await fetch(DATA_FILE, { cache:"no-store" });
    if(!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();

    $("b1").textContent = "Fonte: " + (data?.meta?.source || "dados_cnt.json");
    $("yearEnd").textContent = data?.meta?.year_end ?? "—";

    const A = Number(data?.cnt?.A);
    const B = Number(data?.cnt?.B);
    const C = Number(data?.cnt?.C);

    $("cntA").textContent = fmt1(A);
    $("Aabs").textContent = fmt2(A);
    $("Babs").textContent = Number.isFinite(B) ? ((B>=0?"+":"") + fmt2(B)) : "N/D";
    $("Cabs").textContent = fmt2(C);
    $("rating").textContent = data?.cnt?.rating || gradeFromA(A);

    const IBI = Number(data?.indices?.IBI);
    const IAB = Number(data?.indices?.IAB);
    const HID = Number(data?.indices?.HID);
    const ENT = Number(data?.indices?.ENT);
    const PAN = Number(data?.indices?.PAN);

    $("ibi").textContent = fmt1(IBI);
    $("iab").textContent = Number.isFinite(IAB) ? fmt1(IAB) : "N/D";
    $("hid").textContent = fmt1(HID);
    $("ent").textContent = fmt1(ENT);
    $("pan").textContent = fmt1(PAN);

    // REL = percentil da série 10y
    const s10 = Array.isArray(data?.telemetry_10y) ? data.telemetry_10y.map(Number).filter(Number.isFinite) : null;
    if(s10 && s10.length >= 2){
      const last = s10.at(-1);
      const sorted = [...s10].sort((a,b)=>a-b);
      const idx = sorted.indexOf(last);
      const rel = (idx / Math.max(1, (sorted.length-1))) * 100;
      $("relA").textContent = rel.toFixed(1) + "/100";
      series = s10;
      $("telemetryTitle").textContent = "TELEMETRIA (JSON) — Série 10 anos";
      $("telemetryHint").textContent = "Histórico: " + s10.length + " pontos • Última: " + last.toFixed(2);
    }else{
      const s30 = Array.isArray(data?.telemetry_30d) ? data.telemetry_30d.map(Number).filter(Number.isFinite) : [];
      series = s30.length ? s30 : null;
      $("telemetryTitle").textContent = "TELEMETRIA (JSON) — Série 30D";
      $("telemetryHint").textContent = series ? ("Histórico: " + series.length + " pontos • Última: " + series.at(-1).toFixed(2)) : "Sem série no JSON.";
      $("relA").textContent = "N/D";
    }

  }catch(e){
    $("b1").textContent = "Fonte: sem dados";
    $("telemetryHint").textContent = "Não carregou " + DATA_FILE + " (coloque na mesma pasta do index).";
    console.warn(e);
  }
}
carregarDadosReais();

/* ===== Telemetria Canvas ===== */
const wave = $("wave");
const wctx = wave.getContext("2d");

function resizeWave(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  wave.width = Math.floor(wave.clientWidth * dpr);
  wave.height = Math.floor(wave.clientHeight * dpr);
  wctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize", resizeWave);
resizeWave();

let t = 0;
function drawWave(){
  const W = wave.clientWidth, H = wave.clientHeight;
  wctx.clearRect(0,0,W,H);
  wctx.fillStyle = "rgba(0,0,0,.18)";
  wctx.fillRect(0,0,W,H);

  wctx.strokeStyle = "rgba(110,210,255,.10)";
  wctx.lineWidth = 1;
  for(let y=12;y<H;y+=18){
    wctx.beginPath(); wctx.moveTo(0,y); wctx.lineTo(W,y); wctx.stroke();
  }

  wctx.strokeStyle = "rgba(120,230,255,.95)";
  wctx.lineWidth = 2;
  wctx.beginPath();

  const s = (series && series.length >= 2) ? series : null;

  if(!s){
    for(let x=0;x<W;x++){
      const y = (H*0.55) + Math.sin((x+t)/48)*(H*0.18) + Math.sin((x+t)/17)*(H*0.06);
      if(x===0) wctx.moveTo(x,y); else wctx.lineTo(x,y);
    }
  }else{
    const min = Math.min(...s);
    const max = Math.max(...s);
    const span = (max-min) || 1;

    for(let x=0;x<W;x++){
      const idx = Math.floor((x/(W-1)) * (s.length-1));
      const v = (s[idx]-min)/span;
      const base = (H*0.80) - v*(H*0.60);
      const y = base + Math.sin((x+t)/46)*(H*0.02);
      if(x===0) wctx.moveTo(x,y); else wctx.lineTo(x,y);
    }
  }
  wctx.stroke();

  wctx.globalCompositeOperation = "lighter";
  wctx.strokeStyle = "rgba(110,210,255,.35)";
  wctx.lineWidth = 6;
  wctx.stroke();
  wctx.globalCompositeOperation = "source-over";

  t += 1.6;
  requestAnimationFrame(drawWave);
}
drawWave();

/* ===== Hologram points ===== */
const holo = $("holo");
const hctx = holo.getContext("2d");
let pts = [];
let holoT = 0;

function resizeHolo(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  holo.width = Math.floor(holo.clientWidth * dpr);
  holo.height = Math.floor(holo.clientHeight * dpr);
  hctx.setTransform(dpr,0,0,dpr,0,0);

  const W = holo.clientWidth, H = holo.clientHeight;
  const N = Math.floor((W*H) / 14000);
  pts = new Array(N).fill(0).map(()=>({
    x: Math.random()*W, y: Math.random()*H,
    r: 0.8 + Math.random()*1.8,
    s: 0.6 + Math.random()*1.2,
    ph: Math.random()*Math.PI*2
  }));
}
window.addEventListener("resize", resizeHolo);
resizeHolo();

function drawHolo(){
  const W = holo.clientWidth, H = holo.clientHeight;
  hctx.clearRect(0,0,W,H);

  const A = parseFloat($("cntA").textContent);
  const energy = Number.isFinite(A) ? clamp(A/100, 0.15, 1) : 0.55;

  const PAN = parseFloat($("pan").textContent);
  const ENT = parseFloat($("ent").textContent);
  const risk = (Number.isFinite(PAN)?PAN:40)*0.55 + (Number.isFinite(ENT)?ENT:30)*0.45;
  const riskN = clamp(risk/100, 0, 1);

  for(const p of pts){
    const pulse = (0.35 + 0.65*Math.sin(holoT*p.s + p.ph))*energy;
    const rr = p.r + pulse*2.2;
    const a = 0.10 + pulse*0.26;

    const r = Math.floor(80 + 160*riskN);
    const g = Math.floor(220 - 80*riskN);
    const b = Math.floor(255 - 140*riskN);

    hctx.beginPath();
    hctx.fillStyle = `rgba(${r},${g},${b},${a})`;
    hctx.arc(p.x, p.y, rr, 0, Math.PI*2);
    hctx.fill();
  }

  holoT += 0.06;
  requestAnimationFrame(drawHolo);
}
drawHolo();

/* ===== Conversão DEMO ===== */
const solInput = $("sol");
const out = $("out");
function update(){
  const sol = parseFloat(solInput.value) || 0;
  out.textContent = (sol * RATE_SOL_TO_CNT).toLocaleString("pt-BR") + " CNT";
}
solInput.addEventListener("input", update);
update();

function connect(){ alert("Conexão Phantom/Solana entra aqui depois (ainda é interface)."); }
function buy(){ window.open("https://pump.fun/coin/GCVyjNaCbXkwGUuktyNxSXad4ozmTp2fzQr2jieSpump","_blank"); }

/* ===== Modal ===== */
const meanings = {
  IBI:"Índice Biótico: integridade e vigor do sistema vivo.",
  IAB:"Índice Abiótico: suporte físico (clima/solo/energia).",
  HID:"Índice Hídrico: estabilidade e dinâmica da água.",
  PAN:"Pressão Antrópica: risco/penalidade por uso humano.",
  ENT:"Entropia: volatilidade/perda de ordem (ajuste).",
  REL:"REL: posição do estado atual dentro do histórico."
};

const modal = $("modal");
const overlay = $("modalOverlay");
const mTitle = $("mTitle");
const mText  = $("mText");
const closeBtn = $("closeBtn");

function openModal(key){
  mTitle.textContent = key;
  mText.textContent = meanings[key] || "Sem descrição.";
  overlay.style.display = "block";
  modal.style.display = "block";
}
function closeModal(){ overlay.style.display="none"; modal.style.display="none"; }
document.querySelectorAll(".kv").forEach(el=> el.addEventListener("click", ()=>openModal(el.dataset.k)));
overlay.addEventListener("click", closeModal);
closeBtn.addEventListener("click", closeModal);
</script>
</body>
        </html>
