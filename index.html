<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OS.CNT — Observatório CNT Amazônia</title>

  <style>
    :root{
      --c: rgba(120,220,255,.9);
      --c2: rgba(120,220,255,.35);
      --glass: rgba(4,18,32,.28);
      --glass2: rgba(4,18,32,.18);
      --stroke: rgba(120,220,255,.22);
      --text: #a7e8ff;
      --text2:#7fd6ff;
      --shadow: 0 0 18px rgba(120,220,255,.12), 0 0 60px rgba(0,255,255,.05);
    }

    html,body{
      margin:0;
      height:100%;
      background:#01040a;
      color:var(--text);
      font-family: "Segoe UI", Arial, sans-serif;
      overflow:hidden;
    }

    /* ===== MAPA (PROTAGONISTA) ===== */
    #stage{
      position:fixed; inset:0;
      background:#01040a;
    }

    #bg{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      transform: translateZ(0);
      /* pulsar sem parecer “efeito gamer” */
      animation: biomePulse 12s ease-in-out infinite;
      filter: brightness(.92) contrast(1.12) saturate(1.15);
    }

    /* leve respiração do bioma (brilho + micro zoom) */
    @keyframes biomePulse{
      0%   { filter: brightness(.90) contrast(1.10) saturate(1.10); transform: scale(1.00); }
      50%  { filter: brightness(.98) contrast(1.18) saturate(1.22); transform: scale(1.012); }
      100% { filter: brightness(.90) contrast(1.10) saturate(1.10); transform: scale(1.00); }
    }

    /* camada holográfica difusa */
    #holo{
      position:absolute; inset:0;
      background:
        radial-gradient(1000px 520px at 50% 45%, rgba(80,255,255,.09), transparent 60%),
        radial-gradient(900px 700px at 30% 60%, rgba(120,220,255,.06), transparent 60%),
        radial-gradient(1000px 800px at 70% 60%, rgba(120,220,255,.05), transparent 60%);
      mix-blend-mode: screen;
      pointer-events:none;
      animation:holo 14s ease-in-out infinite;
      filter: blur(.3px);
    }
    @keyframes holo{
      0%{ opacity:.55; transform: translateY(0); }
      50%{ opacity:.75; transform: translateY(-6px); }
      100%{ opacity:.55; transform: translateY(0); }
    }

    /* partículas */
    #fx{
      position:absolute; inset:0;
      pointer-events:none;
      filter: drop-shadow(0 0 8px rgba(120,220,255,.25));
    }

    /* torres (polos de atividade) */
    .tower{
      position:absolute;
      width:18px;
      bottom:18%;
      transform: translateX(-50%);
      pointer-events:none;
      opacity:.85;
      filter: drop-shadow(0 0 18px rgba(120,220,255,.25));
    }
    .tower:before{
      content:"";
      display:block;
      width:100%;
      height: clamp(90px, 14vh, 220px);
      border-radius: 10px;
      background: linear-gradient(to top,
        rgba(120,220,255,0.0),
        rgba(120,220,255,0.15),
        rgba(120,220,255,0.55),
        rgba(120,220,255,0.15),
        rgba(120,220,255,0.0)
      );
      border: 1px solid rgba(120,220,255,.22);
      backdrop-filter: blur(2px);
      animation: tower 6s ease-in-out infinite;
    }
    .tower:after{
      content:"";
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:-6px;
      width:56px; height:12px;
      border-radius:999px;
      background: radial-gradient(circle, rgba(120,220,255,.50), transparent 60%);
      opacity:.9;
      filter: blur(.2px);
      animation: ring 3.2s ease-in-out infinite;
    }
    @keyframes tower{
      0%{ opacity:.55; transform: scaleY(.92); }
      50%{ opacity:.95; transform: scaleY(1.06); }
      100%{ opacity:.55; transform: scaleY(.92); }
    }
    @keyframes ring{
      0%{ opacity:.35; transform: translateX(-50%) scale(0.92); }
      50%{ opacity:.75; transform: translateX(-50%) scale(1.06); }
      100%{ opacity:.35; transform: translateX(-50%) scale(0.92); }
    }

    /* ===== HUD (OVERLAY) ===== */
    .panel{
      position:absolute;
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      border-radius: 18px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 16px 18px;
      pointer-events:auto;
    }

    /* importante: HUD não “pesa” no mapa */
    .panel.soft{
      background: linear-gradient(180deg, rgba(4,18,32,.22), rgba(4,18,32,.12));
      border-color: rgba(120,220,255,.16);
    }

    /* topo esquerdo */
    #status{
      top: 18px; left: 18px;
      width: min(340px, 32vw);
    }

    /* topo centro (telemetria fina) */
    #telemetry{
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      width: min(760px, 52vw);
      height: 140px;
      padding: 10px 14px;
      pointer-events:none; /* não atrapalha o mapa */
    }

    /* topo direito (sub-índices) */
    #indices{
      top: 18px; right: 18px;
      width: min(260px, 22vw);
      pointer-events:none; /* não atrapalha o mapa */
    }

    /* barra inferior compacta (compra/PSA) */
    #psa{
      left: 50%;
      transform: translateX(-50%);
      bottom: 14px;
      width: min(920px, 86vw);
      padding: 12px 14px;
      border-radius: 16px;
    }

    .kicker{
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size: 11px;
      color: rgba(160,235,255,.85);
    }
    .title{
      font-size: 16px;
      color: #d9fbff;
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
    }

    .logo{
      width:22px;height:22px;border-radius:50%;
      border:1px solid rgba(120,220,255,.35);
      box-shadow: 0 0 12px rgba(120,220,255,.18);
      background:
        radial-gradient(circle at 30% 30%, rgba(120,220,255,.65), transparent 55%),
        radial-gradient(circle at 60% 70%, rgba(0,255,255,.25), transparent 60%);
    }

    #cntValue{
      font-size: 64px;
      line-height: 1;
      margin: 8px 0 10px;
      color: #d9fbff;
      text-shadow: 0 0 20px rgba(120,220,255,.22);
      font-weight: 300;
    }

    .muted{ color: rgba(160,235,255,.72); font-size: 13px; }

    .row{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      font-size: 13px;
      color: rgba(170,242,255,.85);
      margin: 7px 0;
    }

    .metric{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size: 14px;
      padding: 6px 0;
    }
    .metric b{ color:#e7feff; font-weight:600; letter-spacing:.03em; }
    .dots{
      flex:1;
      height: 1px;
      margin: 0 10px;
      background: linear-gradient(to right, transparent, rgba(120,220,255,.35), transparent);
      opacity:.85;
    }

    /* gráficos */
    #telemetry canvas{
      width:100%; height:100%;
      display:block;
      filter: drop-shadow(0 0 10px rgba(120,220,255,.25));
    }

    /* PSA / compra */
    .psaGrid{
      display:grid;
      grid-template-columns: 1.3fr 1fr 1fr 1fr auto;
      gap:10px;
      align-items:center;
    }
    .field{
      border: 1px solid rgba(120,220,255,.18);
      background: rgba(0,10,18,.25);
      border-radius: 12px;
      padding: 10px 10px;
    }
    .field label{
      display:block;
      font-size: 11px;
      color: rgba(160,235,255,.7);
      margin-bottom:6px;
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    .field input, .field select{
      width:100%;
      background: transparent;
      border:0;
      outline:none;
      color:#d9fbff;
      font-size: 14px;
    }

    .btn{
      height: 44px;
      padding: 0 16px;
      border-radius: 12px;
      border: 1px solid rgba(120,220,255,.28);
      background: linear-gradient(180deg, rgba(0,40,60,.35), rgba(0,20,35,.25));
      color:#d9fbff;
      cursor:pointer;
      box-shadow: 0 0 14px rgba(120,220,255,.12);
      transition: transform .15s ease, opacity .15s ease, border-color .15s ease;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(120,220,255,.45); }
    .btn:active{ transform: translateY(0px); opacity:.9; }

    .buyRow{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(120,220,255,.18);
      background: rgba(0,10,18,.18);
      font-size: 12px;
      color: rgba(200,255,255,.85);
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: rgba(120,220,255,.9);
      box-shadow: 0 0 10px rgba(120,220,255,.35);
    }

    /* responsivo: em telas pequenas, reduz para não atrapalhar o mapa */
    @media (max-width: 980px){
      #telemetry{ width: 56vw; height: 120px; }
      #status{ width: 320px; }
      #indices{ width: 240px; }
      .psaGrid{ grid-template-columns: 1fr 1fr; }
      .buyRow{ justify-content:flex-start; }
    }
    @media (max-width: 720px){
      #telemetry{ display:none; } /* some para não cobrir o mapa */
      #indices{ width: 210px; }
      #status{ width: min(320px, 86vw); }
      #cntValue{ font-size: 54px; }
      #psa{ width: 92vw; }
    }
  </style>
</head>

<body>
  <div id="stage">
    <img id="bg" src="imagem_cnt.png" alt="Mapa CNT" />
    <canvas id="fx"></canvas>
    <div id="holo"></div>

    <!-- torres em posições “bons pontos visuais” -->
    <div class="tower" style="left:25%;"></div>
    <div class="tower" style="left:43%; bottom:22%;"></div>
    <div class="tower" style="left:58%; bottom:18%;"></div>
    <div class="tower" style="left:72%; bottom:26%;"></div>
    <div class="tower" style="left:86%; bottom:19%;"></div>

    <!-- HUD -->
    <div id="status" class="panel">
      <div class="title">
        <span class="logo"></span>
        <div>
          <div class="kicker">OS.CNT</div>
          <div style="opacity:.9">Earth Environmental Monitoring Infrastructure</div>
        </div>
      </div>

      <div id="cntValue">72.4</div>

      <div class="row">
        <span class="pill"><span class="dot"></span> Confiança: <b>Alta</b></span>
        <span class="pill">Escala 0–100</span>
      </div>

      <div style="margin-top:10px" class="muted">
        Estado do sistema: <b style="color:#e7feff">Regulação estável</b><br>
        Modo operacional: Monitoramento ativo<br>
        Status: Operacional
      </div>

      <div style="margin-top:10px" class="muted">
        <b style="color:#e7feff">O que significa:</b><br>
        CNT = síntese vital do território (Bioelétrico • Abiótico • Biótico • Hídrico) − (Entropia • Pressão Antrópica)
      </div>
    </div>

    <div id="telemetry" class="panel soft">
      <!-- canvas entra via JS -->
    </div>

    <div id="indices" class="panel soft">
      <div class="metric"><b>IBE</b><span class="dots"></span><span id="ibe">88</span></div>
      <div class="metric"><b>IAB</b><span class="dots"></span><span id="iab">88</span></div>
      <div class="metric"><b>IBI</b><span class="dots"></span><span id="ibi">11</span></div>
      <div class="metric"><b>HID</b><span class="dots"></span><span id="hid">83</span></div>
      <div class="metric"><b>ENT</b><span class="dots"></span><span id="ent">88</span></div>
      <div class="metric"><b>PAN</b><span class="dots"></span><span id="pan">78</span></div>

      <div style="margin-top:10px" class="muted">
        IBE: bioeletricidade • IAB: clima/solo • IBI: biota • HID: água • ENT: entropia • PAN: pressão humana
      </div>
    </div>

    <div id="psa" class="panel">
      <div class="kicker" style="margin-bottom:8px">
        Compra / Pagamento por Conservação (PSA) — simulador
      </div>

      <div class="psaGrid">
        <div class="field">
          <label>Cotação CNT (estimada)</label>
          <div style="display:flex; gap:8px; align-items:center;">
            <div class="pill" title="Exemplo (troca real via Pump.fun)"><span class="dot"></span><span id="cntQuote">—</span></div>
            <div class="muted" style="white-space:nowrap">CNT ⇄ SOL</div>
          </div>
        </div>

        <div class="field">
          <label>Valor em SOL</label>
          <input id="solIn" type="number" step="0.01" min="0" value="0.10">
        </div>

        <div class="field">
          <label>Recebe (estimado)</label>
          <input id="cntOut" type="text" value="—" readonly>
        </div>

        <div class="field">
          <label>Carteira</label>
          <input id="wallet" type="text" value="não conectada" readonly>
        </div>

        <div class="buyRow">
          <button class="btn" id="btnConnect">Conectar Phantom</button>
          <button class="btn" id="btnBuy">Comprar CNT (Pump.fun)</button>
        </div>
      </div>

      <div class="muted" style="margin-top:8px">
        * Para compra real: abrimos o Pump.fun com seu mint. A execução da troca acontece na interface do Pump.fun (seguro / assinatura na carteira).
      </div>
    </div>
  </div>

  <script>
    // ===== CONFIG =====
    const PUMP_URL = "https://pump.fun/coin/GCVyjNaCbXkwGUuktyNxSXad4ozmTp2fzQr2jieSpump";
    // cotação: aqui deixei “estimada” (placeholder), porque pump.fun não fornece API pública simples sem serviços externos.
    // quando você quiser, eu integro com um provedor (DexScreener/Bitquery/Birdeye) — mas aí precisa endpoint/API.
    let cntPerSol = 1000; // EXEMPLO: 1 SOL -> 1000 CNT (troca estimada)

    // ===== TELEMETRIA (gráfico fisiológico fino, sem “pesar”) =====
    (function telemetry(){
      const t = document.getElementById("telemetry");
      const c = document.createElement("canvas");
      t.appendChild(c);

      function resize(){
        const r = t.getBoundingClientRect();
        c.width = Math.max(10, Math.floor(r.width));
        c.height = Math.max(10, Math.floor(r.height));
      }
      window.addEventListener("resize", resize);
      resize();

      const ctx = c.getContext("2d");
      let x = 0;

      function draw(){
        ctx.clearRect(0,0,c.width,c.height);

        // fundo quase invisível
        ctx.fillStyle = "rgba(0,18,30,.22)";
        ctx.fillRect(0,0,c.width,c.height);

        // linha principal (pulso)
        ctx.strokeStyle = "rgba(140,240,255,.95)";
        ctx.lineWidth = 2;
        ctx.beginPath();

        const mid = c.height * 0.55;
        for(let i=0;i<c.width;i++){
          const y = mid
            + Math.sin((i+x)/58)* (c.height*0.12)
            + Math.sin((i+x)/17)* (c.height*0.05)
            + Math.sin((i+x)/160)* (c.height*0.08);
          if(i===0) ctx.moveTo(i,y);
          else ctx.lineTo(i,y);
        }
        ctx.stroke();

        // brilho suave
        ctx.strokeStyle = "rgba(140,240,255,.25)";
        ctx.lineWidth = 7;
        ctx.stroke();

        x += 2.2;
        requestAnimationFrame(draw);
      }
      draw();
    })();

    // ===== PARTÍCULAS (sutil) =====
    (function particles(){
      const canvas = document.getElementById("fx");
      const ctx = canvas.getContext("2d");
      let W,H,parts;

      function resize(){
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
        const n = Math.floor((W*H) / 42000); // densidade suave
        parts = Array.from({length:n}, () => ({
          x: Math.random()*W,
          y: Math.random()*H,
          r: 0.6 + Math.random()*1.6,
          vx: (-0.15 + Math.random()*0.3),
          vy: (-0.10 + Math.random()*0.25),
          a: 0.15 + Math.random()*0.35
        }));
      }
      window.addEventListener("resize", resize);
      resize();

      function tick(){
        ctx.clearRect(0,0,W,H);
        ctx.fillStyle = "rgba(120,220,255,.9)";

        for(const p of parts){
          p.x += p.vx; p.y += p.vy;
          if(p.x< -10) p.x = W+10;
          if(p.x> W+10) p.x = -10;
          if(p.y< -10) p.y = H+10;
          if(p.y> H+10) p.y = -10;

          ctx.globalAlpha = p.a;
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        requestAnimationFrame(tick);
      }
      tick();
    })();

    // ===== SIMULAÇÃO “TEMPO REAL” DOS ÍNDICES (leve, sem inventar ciência) =====
    // aqui é só UI dinâmica, depois você troca por dados reais.
    (function realtimeMock(){
      const els = {
        cnt: document.getElementById("cntValue"),
        ibe: document.getElementById("ibe"),
        iab: document.getElementById("iab"),
        ibi: document.getElementById("ibi"),
        hid: document.getElementById("hid"),
        ent: document.getElementById("ent"),
        pan: document.getElementById("pan"),
      };

      function clamp(v){ return Math.max(0, Math.min(100, v)); }
      function jitter(v, s){ return clamp(v + (Math.random()*2-1)*s); }

      let state = { cnt:72.4, ibe:88, iab:88, ibi:11, hid:83, ent:88, pan:78 };

      setInterval(()=>{
        // variação mínima (parece telemetria real)
        state.ibe = jitter(state.ibe, 0.35);
        state.iab = jitter(state.iab, 0.25);
        state.ibi = jitter(state.ibi, 0.30);
        state.hid = jitter(state.hid, 0.28);
        state.ent = jitter(state.ent, 0.18);
        state.pan = jitter(state.pan, 0.22);

        // CNT agregado simples (você vai trocar pelo modelo real depois)
        const base = (state.ibe + state.iab + state.ibi + state.hid) / 4;
        const pen  = (state.ent + state.pan) / 2;
        state.cnt = clamp(base - (pen-50)*0.12);

        els.ibe.textContent = state.ibe.toFixed(0);
        els.iab.textContent = state.iab.toFixed(0);
        els.ibi.textContent = state.ibi.toFixed(0);
        els.hid.textContent = state.hid.toFixed(0);
        els.ent.textContent = state.ent.toFixed(0);
        els.pan.textContent = state.pan.toFixed(0);
        els.cnt.textContent = state.cnt.toFixed(1);
      }, 900);
    })();

    // ===== TROCA CNT ⇄ SOL (estimada) =====
    const solIn = document.getElementById("solIn");
    const cntOut = document.getElementById("cntOut");
    const cntQuote = document.getElementById("cntQuote");
    function updateQuote(){
      cntQuote.textContent = `1 SOL ≈ ${cntPerSol.toLocaleString("pt-BR")} CNT`;
      const sol = parseFloat(solIn.value || "0");
      const out = sol * cntPerSol;
      cntOut.value = sol > 0 ? `${out.toLocaleString("pt-BR")} CNT` : "—";
    }
    solIn.addEventListener("input", updateQuote);
    updateQuote();

    // ===== WALLET (Phantom simples) =====
    const walletField = document.getElementById("wallet");
    const btnConnect = document.getElementById("btnConnect");
    const btnBuy = document.getElementById("btnBuy");

    btnBuy.onclick = () => window.open(PUMP_URL, "_blank");

    btnConnect.onclick = async () => {
      try{
        if(!window.solana || !window.solana.isPhantom){
          alert("Phantom não detectada. Instale a Phantom no navegador e tente de novo.");
          return;
        }
        const resp = await window.solana.connect();
        const pub = resp.publicKey?.toString?.() || "conectada";
        walletField.value = pub.slice(0,6) + "..." + pub.slice(-6);
      }catch(e){
        console.log(e);
        alert("Conexão cancelada ou falhou.");
      }
    };
  </script>
</body>
</html>
