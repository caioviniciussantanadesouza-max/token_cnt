<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CNT — Centro Natural TEC Amazônia</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:Arial, sans-serif;
  color:#c8f3ff;
}
#app{
  position:fixed;
  inset:0;
  display:grid;
  grid-template-columns: 300px 1fr 360px;
  grid-template-rows: 120px 1fr;
  gap:14px;
  padding:14px;
}
.glass{
  background: rgba(2,12,24,.46);
  border:1px solid rgba(110,210,255,.18);
  border-radius:22px;
}
#header{
  grid-column:1 / 4;
  padding:14px;
  text-align:center;
}
#center{
  position:relative;
  overflow:hidden;
}
#mapWrap{
  position:absolute;
  inset:0;
}
.layer{
  position:absolute;
  inset:0;
}
#yearIndicator{
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  font-size:28px;
  color:#00ffff;
  text-shadow:0 0 12px #00ffff;
  z-index:1000;
  letter-spacing:3px;
}
</style>
</head>

<body>
<div id="app">

<div id="header" class="glass">
<h2>CNT — Centro Natural TEC Amazônia</h2>
Loop ecológico real 2000 → 2025
</div>

<div class="glass"></div>

<div id="center" class="glass">
<div id="mapWrap">
<canvas id="cnvBase" class="layer"></canvas>
<canvas id="cnvPoints" class="layer"></canvas>
<div id="yearIndicator">2000</div>
</div>
</div>

<div class="glass"></div>

</div>

<script>

// =============================
// CONFIG
// =============================

const MIN_YEAR = 2000;
const MAX_YEAR = 2025;
const INTERVAL = 60000;

let currentYear = MIN_YEAR;
let allPoints = null;
let bbox = null;

// =============================
// CANVAS
// =============================

const cnvBase = document.getElementById("cnvBase");
const cnvPoints = document.getElementById("cnvPoints");
const ctxBase = cnvBase.getContext("2d");
const ctxP = cnvPoints.getContext("2d");

function resize(){
  const w = cnvBase.parentElement.clientWidth;
  const h = cnvBase.parentElement.clientHeight;
  cnvBase.width = w;
  cnvBase.height = h;
  cnvPoints.width = w;
  cnvPoints.height = h;
}
window.addEventListener("resize", resize);
resize();

// =============================
// PROJECTION
// =============================

function calcBBox(fc){
  let minx=Infinity,miny=Infinity,maxx=-Infinity,maxy=-Infinity;
  fc.features.forEach(f=>{
    const [x,y]=f.geometry.coordinates;
    if(x<minx)minx=x;
    if(y<miny)miny=y;
    if(x>maxx)maxx=x;
    if(y>maxy)maxy=y;
  });
  return [minx,miny,maxx,maxy];
}

function proj(lon,lat){
  const [minx,miny,maxx,maxy]=bbox;
  const w=cnvBase.width;
  const h=cnvBase.height;
  return [
    (lon-minx)/(maxx-minx)*w,
    (maxy-lat)/(maxy-miny)*h
  ];
}

// =============================
// CORES
// =============================

function getColor(type){
  if(type==="vegetation") return "rgba(0,255,100,";
  if(type==="deforestation") return "rgba(255,255,0,";
  if(type==="urban") return "rgba(255,0,0,";
  if(type==="hydro") return "rgba(0,170,255,";
  return "rgba(255,255,255,";
}

// =============================
// RENDER
// =============================

function renderYear(){

  document.getElementById("yearIndicator").innerText=currentYear;

  ctxP.clearRect(0,0,cnvPoints.width,cnvPoints.height);
  ctxP.globalCompositeOperation="lighter";

  const filtered=allPoints.features.filter(f=>
    Number(f.properties.year)===currentYear
  );

  filtered.forEach(f=>{
    const [x,y]=proj(
      f.geometry.coordinates[0],
      f.geometry.coordinates[1]
    );

    const base=getColor(f.properties.type);
    const pulse=0.5+0.5*Math.sin(Date.now()*0.002);
    ctxP.fillStyle=base+(0.3+0.5*pulse)+")";
    ctxP.beginPath();
    ctxP.arc(x,y,1.5+2*pulse,0,Math.PI*2);
    ctxP.fill();
  });

  ctxP.globalCompositeOperation="source-over";

  currentYear++;
  if(currentYear>MAX_YEAR) currentYear=MIN_YEAR;
}

// =============================
// INIT
// =============================

async function init(){
  const res=await fetch("vege_pts.geojson");
  allPoints=await res.json();
  bbox=calcBBox(allPoints);
  renderYear();
  setInterval(renderYear,INTERVAL);
}

init();

</script>
</body>
</html>
