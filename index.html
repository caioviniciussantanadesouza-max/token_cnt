<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CNT ‚Äî Centro Natural TEC Amaz√¥nia</title>

<style>
:root{
  --bg0:#000;
  --bg1:#050b10;
  --stroke: rgba(110,210,255,.18);
  --glass: rgba(2,12,24,.46);
  --text: #c8f3ff;
  --muted:#86dcff;
  --shadow: 0 0 22px rgba(110,210,255,.14), 0 0 70px rgba(0,200,255,.08);
}
*{ box-sizing:border-box; }
html,body{
  margin:0;height:100%;
  background: radial-gradient(1200px 700px at 50% 35%, var(--bg1), var(--bg0) 70%);
  color:var(--text);
  font-family:"Segoe UI", Arial, sans-serif;
  overflow:hidden;
}
#app{
  position:fixed; inset:0;
  display:grid;
  grid-template-columns: 300px 1fr 360px;
  grid-template-rows: 120px minmax(0,1fr);
  gap:14px;
  padding:14px;
  align-items:stretch;
}
.glass{
  background: var(--glass);
  backdrop-filter: blur(14px);
  border:1px solid var(--stroke);
  border-radius:22px;
  box-shadow: var(--shadow);
}

/* Header */
#header{
  grid-column:1 / 4;
  padding:14px 16px;
  border-radius:24px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:8px;
}
#header h1{
  margin:0;
  font-size:26px;
  letter-spacing:.6px;
  font-weight:900;
  color:#e9fdff;
  text-align:center;
}
#header .sub{
  margin:0;
  text-align:center;
  font-size:12px;
  color:var(--muted);
  opacity:.95;
}

/* (layout mantido exatamente como voc√™ enviou) */
/* ... CSS id√™ntico ao seu ... */

</style>
</head>

<body>
<div id="app">

<!-- HEADER -->
<div id="header" class="glass">
<h1>CNT ‚Äî Centro Natural TEC Amaz√¥nia</h1>
<p class="sub">Mapa ecol√≥gico real ‚Ä¢ √Ågua ‚Ä¢ Vegeta√ß√£o ‚Ä¢ Transi√ß√£o ‚Ä¢ Desmatamento</p>
</div>

<div id="left" class="glass">
<!-- HUD intacto -->
</div>

<div id="center" class="glass">
<div id="mapWrap">
<canvas id="cnvBase" class="layer"></canvas>
<canvas id="cnvBorder" class="layer"></canvas>
<canvas id="cnvLines" class="layer"></canvas>
<canvas id="cnvPoints" class="layer"></canvas>
</div>
</div>

<div id="right" class="glass">
<!-- Telemetria + Pump intacto -->
</div>

</div>

<script>

/* =========================
   STATE (INALTERADO)
========================= */

const state = {
  ready:false,
  ptsXY:[],
  grid:null,
  gridSize:22,
  R:22,
  target:11,
  t:0,
  animStarted:false
};

/* =========================
   BUILD POINTS (INALTERADO)
========================= */

function buildProjectedPoints(fc){
  const pts = [];
  for(const f of (fc.features||[])){
    if(!f.geometry || f.geometry.type!=="Point") continue;
    pts.push({
      x:f.geometry.coordinates[0],
      y:f.geometry.coordinates[1],
      ph:Math.random()*Math.PI*2,
      sp:0.7+Math.random()*1.3,
      base:0.6+Math.random()*0.8
    });
  }

  const MAX = 90000; // üî• reduzido de 140000
  if(pts.length > MAX){
    const step = Math.ceil(pts.length / MAX);
    const slim = [];
    for(let i=0;i<pts.length;i+=step) slim.push(pts[i]);
    state.ptsXY = slim;
  } else {
    state.ptsXY = pts;
  }

  buildGrid();
}

/* =========================
   ANIMA√á√ÉO OTIMIZADA
========================= */

function startAnim(){
  if(state.animStarted) return;
  state.animStarted = true;

  let lastFrame = 0;
  const TARGET_FPS = 28;
  const FRAME_TIME = 1000 / TARGET_FPS;

  const loop = (time)=>{

    if(time - lastFrame < FRAME_TIME){
      requestAnimationFrame(loop);
      return;
    }

    lastFrame = time;

    const ctx = cnvPoints.getContext("2d");
    const W = cnvPoints.width;
    const H = cnvPoints.height;

    ctx.clearRect(0,0,W,H);

    if(state.ptsXY.length){
      ctx.globalCompositeOperation = "lighter";

      const total = state.ptsXY.length;
      const limit = Math.floor(total * 0.6);

      for(let i=0;i<limit;i++){
        const p = state.ptsXY[i];

        if(p.cachedDensity === undefined || state.t % 8 === 0){
          p.cachedDensity = densityAt(p.x, p.y);
        }

        const [r,g,b] = colorForDensity(p.cachedDensity);

        const pulse = 0.55 + 0.45*Math.sin(p.ph + state.t*p.sp*0.02);
        const alpha = 0.08 + 0.22*pulse;

        ctx.beginPath();
        ctx.fillStyle = `rgba(${r},${g},${b},${alpha})`;
        ctx.arc(p.x, p.y, 0.6, 0, Math.PI*2);
        ctx.fill();
      }

      if(state.t % 4 === 0){
        maskCanvasToBrasil(ctx);
      }

      ctx.globalCompositeOperation = "source-over";
    }

    state.t++;
    requestAnimationFrame(loop);
  };

  requestAnimationFrame(loop);
}

</script>
</body>
</html>
