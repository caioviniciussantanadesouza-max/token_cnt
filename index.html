<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CNT — Centro Natural TEC Amazônia</title>

<style>
:root{
  --bg0:#000;
  --bg1:#050b10;
  --stroke: rgba(110,210,255,.18);
  --glass: rgba(2,12,24,.46);
  --text: #c8f3ff;
  --muted:#86dcff;
  --shadow: 0 0 22px rgba(110,210,255,.14), 0 0 70px rgba(0,200,255,.08);
}
*{ box-sizing:border-box; }
html,body{
  margin:0;height:100%;
  background: radial-gradient(1200px 700px at 50% 35%, var(--bg1), var(--bg0) 70%);
  color:var(--text);
  font-family:"Segoe UI", Arial, sans-serif;
  overflow:hidden;
}
#app{
  position:fixed; inset:0;
  display:grid;
  grid-template-columns: 300px 1fr 360px;
  grid-template-rows: 120px minmax(0,1fr);
  gap:14px;
  padding:14px;
  align-items:stretch;
}
.glass{
  background: var(--glass);
  backdrop-filter: blur(14px);
  border:1px solid var(--stroke);
  border-radius:22px;
  box-shadow: var(--shadow);
}

/* Header */
#header{
  grid-column:1 / 4;
  padding:14px 16px;
  border-radius:24px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:8px;
}
#header h1{
  margin:0;
  font-size:26px;
  letter-spacing:.6px;
  font-weight:900;
  color:#e9fdff;
  text-align:center;
}

/* Left */
#left{
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  min-height:0;
  overflow:hidden;
}
.big{
  font-size:56px;
  line-height:1;
  font-weight:260;
  color:#e9fdff;
  margin:0;
}
.small{
  font-size:12px;
  color:var(--muted);
  opacity:.95;
}
.hr{
  height:1px;
  background:linear-gradient(90deg,transparent,rgba(110,210,255,.30),transparent);
  margin:6px 0;
}
.abclist{ display:grid; gap:8px; }
.abcline{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:7px 10px;
  border:1px solid rgba(110,210,255,.14);
  background:rgba(0,0,0,.18);
  border-radius:14px;
  font-size:12px;
  cursor:pointer;
  transition:all .18s ease;
}
.abcline:hover{
  box-shadow:0 0 12px rgba(110,210,255,.22);
  transform:translateY(-1px);
}
.abcline b{ color:#e9fdff; font-weight:900; }
.abcline span{ color:#d5fbff; font-weight:900; }

.grid2{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:8px 10px;
}
.kv{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:12px;
  padding:7px 10px;
  border:1px solid rgba(110,210,255,.16);
  border-radius:14px;
  background:rgba(0,0,0,.18);
  cursor:pointer;
  transition:all .18s ease;
}
.kv:hover{
  box-shadow:0 0 12px rgba(110,210,255,.22);
  transform:translateY(-1px);
}
.kv b{ font-weight:900; color:#e9fdff; }
.kv span{ color:#d0fbff; font-weight:900; }

/* ✅ status escondido */
#status{ display:none; }

/* Center */
#center{
  position:relative;
  overflow:hidden;
  border-radius:26px;
  min-height:0;
}
#mapWrap{
  position:absolute; inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background: radial-gradient(900px 600px at 50% 40%, rgba(20,60,80,.35), rgba(0,0,0,1) 70%);
}
.layer{
  position:absolute; inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
}

/* glow + scanlines */
#mapGlow{
  position:absolute; inset:-10%;
  pointer-events:none;
  mix-blend-mode: screen;
  opacity:.22;
  filter: blur(12px);
  background:
    radial-gradient(circle at 42% 55%, rgba(120,220,255,.22), transparent 52%),
    radial-gradient(circle at 70% 45%, rgba(120,220,255,.16), transparent 60%),
    radial-gradient(circle at 35% 70%, rgba(120,220,255,.10), transparent 60%);
  animation: glowPulse 6s ease-in-out infinite;
}
@keyframes glowPulse{
  0%{ opacity:.16; transform:scale(1); }
  50%{ opacity:.30; transform:scale(1.02); }
  100%{ opacity:.16; transform:scale(1); }
}
#scanlines{
  position:absolute; inset:0;
  pointer-events:none;
  opacity:.14;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(120,220,255,.06) 0px,
      rgba(120,220,255,.06) 1px,
      transparent 2px,
      transparent 7px
    );
  mix-blend-mode: overlay;
  animation: scan 3.2s linear infinite;
}
@keyframes scan{ 0%{ transform:translateY(-22px);} 100%{ transform:translateY(22px);} }

/* Right */
#right{
  display:flex;
  flex-direction:column;
  gap:14px;
  min-height:0;
}
#buy, #telemetry{ padding:14px; }
#buy h2{
  margin:0;
  font-size:18px;
  font-weight:900;
  letter-spacing:.4px;
  color:#e9fdff;
}
.row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.btn{
  width:100%;
  background:linear-gradient(180deg,rgba(110,210,255,.20),rgba(0,0,0,.16));
  border:1px solid rgba(110,210,255,.45);
  color:#eafcff;
  border-radius:14px;
  padding:12px 13px;
  cursor:pointer;
  font-weight:900;
  letter-spacing:.2px;
}
.btn:hover{ box-shadow:0 0 18px rgba(110,210,255,.30); }

/* ✅ remove textos extras */
#buy .mut, .valueLine, .smallnote, #telemetryHint { display:none !important; }

#telemetryTitle{
  font-size:12px;
  letter-spacing:.8px;
  color:#d4fbff;
  opacity:.95;
  margin-bottom:8px;
  font-weight:900;
}
#wave{
  width:100%;
  height:74px;
  display:block;
  background: rgba(0,0,0,.22);
  border:1px solid rgba(110,210,255,.14);
  border-radius:14px;
}

/* =========================
   MODAL EXPLICAÇÃO
========================= */
.infoModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.72);
  backdrop-filter:blur(8px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.infoBox{
  width:460px;
  max-width:92%;
  background:rgba(2,12,24,.92);
  border:1px solid rgba(110,210,255,.45);
  border-radius:18px;
  padding:18px 18px 16px;
  box-shadow:0 0 30px rgba(0,200,255,.25);
}
.infoHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
}
#infoTitle{
  font-weight:900;
  color:#e9fdff;
  letter-spacing:.2px;
}
#closeInfo{
  background:none;
  border:none;
  color:#86dcff;
  font-size:22px;
  cursor:pointer;
  line-height:1;
  padding:2px 8px;
}
.infoContent{
  font-size:13px;
  line-height:1.55;
  color:#c8f3ff;
  white-space:pre-line;
}
.infoBadge{
  display:inline-block;
  margin-top:10px;
  font-size:11px;
  color:#bdf4ff;
  border:1px solid rgba(110,210,255,.20);
  background:rgba(0,0,0,.20);
  padding:6px 10px;
  border-radius:999px;
  opacity:.95;
}

@media (max-width: 1100px){
  body{ overflow:auto; }
  #app{ position:relative; grid-template-columns: 1fr; grid-template-rows: auto auto auto auto; }
  #center{ height:48vh; }
}
</style>
</head>

<body>
<div id="app">
  <div id="header" class="glass">
    <h1>CNT — Centro Natural TEC Amazônia</h1>
  </div>

  <div id="left" class="glass">
    <div class="small"><b>CNT</b> (índice único Brasil)</div>
    <div class="big"><span id="eco">72,4</span><span style="font-size:16px; opacity:.9;">/100</span></div>
    <div class="small">RAW auditável: <b id="raw">18,11</b></div>

    <div class="hr"></div>

    <div class="abclist">
      <div class="abcline" data-key="A"><b>A — Estado</b><span id="A">72,43</span></div>
      <div class="abcline" data-key="B"><b>B — Tendência</b><span id="B">-0,10</span></div>
      <div class="abcline" data-key="C"><b>C — Estabilidade</b><span id="C">0,49</span></div>
      <div class="abcline" data-key="R"><b>Grau</b><span id="R">E</span></div>
    </div>

    <div class="hr"></div>

    <div class="small" style="font-weight:900; letter-spacing:.3px;">Sub-índices</div>
    <div class="grid2">
      <div class="kv" data-key="IBE"><b>IBE</b><span id="ibe">55,2</span></div>
      <div class="kv" data-key="IAB"><b>IAB</b><span id="iab">N/D</span></div>
      <div class="kv" data-key="IBI"><b>IBI</b><span id="ibi">23,5</span></div>
      <div class="kv" data-key="HID"><b>HID</b><span id="hid">1,03</span></div>
      <div class="kv" data-key="ENT"><b>ENT</b><span id="ent">86,2</span></div>
      <div class="kv" data-key="PAN"><b>PAN</b><span id="pan">11,7</span></div>
    </div>

    <div id="status">Status: iniciando…</div>
  </div>

  <div id="center" class="glass">
    <div id="mapWrap">
      <canvas id="cnvImg" class="layer"></canvas>
      <canvas id="cnvPts" class="layer"></canvas>
      <div id="mapGlow"></div>
      <div id="scanlines"></div>
    </div>
  </div>

  <div id="right">
    <div id="buy" class="glass">
      <h2>COMPRAR CNT</h2>
      <div class="row">
        <button class="btn" id="btnBuy">Comprar no Pump</button>
      </div>
    </div>

    <div id="telemetry" class="glass">
      <div id="telemetryTitle">TELEMETRIA — Série 10 anos</div>
      <canvas id="wave"></canvas>
      <div id="telemetryHint">Carregando…</div>
    </div>
  </div>
</div>

<!-- =========================
     MODAL EXPLICAÇÃO
========================= -->
<div id="infoModal" class="infoModal">
  <div class="infoBox">
    <div class="infoHeader">
      <span id="infoTitle">Índice</span>
      <button id="closeInfo" aria-label="Fechar">×</button>
    </div>
    <div id="infoContent" class="infoContent"></div>
    <div class="infoBadge">Clique fora para fechar</div>
  </div>
</div>

<script>
/* =========================
   CONFIG
========================= */
const PUMP_URL = "https://pump.fun/coin/GCVyjNaCbXkwGUuktyNxSXad4ozmTp2fzQr2jieSpump";
const IMG_URL = "./mapa.png";

/* performance */
const MAX_POINTS = 45000;
const SAMPLE_STEP = 3;
const MIN_ALPHA = 40;
const MIN_BRIGHT = 60;
const MIN_SAT = 0.38;

/* =========================
   BUY
========================= */
document.getElementById("btnBuy").addEventListener("click", ()=>{
  window.open(PUMP_URL,"_blank","noopener,noreferrer");
});

/* =========================
   CANVAS
========================= */
const cnvImg = document.getElementById("cnvImg");
const cnvPts = document.getElementById("cnvPts");
const ctxI = cnvImg.getContext("2d");
const ctxP = cnvPts.getContext("2d");

function resizeCanvas(cnv, ctx){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const r = cnv.getBoundingClientRect();
  cnv.width  = Math.floor(r.width * dpr);
  cnv.height = Math.floor(r.height * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
function resizeAll(){
  resizeCanvas(cnvImg, ctxI);
  resizeCanvas(cnvPts, ctxP);
  resizeWave();
  if(state.imgLoaded){
    drawImageToCanvas();
    extractPointsFromCanvas();
  }
}
window.addEventListener("resize", ()=>requestAnimationFrame(resizeAll));

/* =========================
   COLOR HELPERS
========================= */
function rgbToHsv(r,g,b){
  r/=255; g/=255; b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  const d=max-min;
  let h=0;
  if(d!==0){
    if(max===r) h=((g-b)/d)%6;
    else if(max===g) h=(b-r)/d+2;
    else h=(r-g)/d+4;
    h*=60;
    if(h<0) h+=360;
  }
  const s = max===0?0:d/max;
  const v = max;
  return [h,s,v];
}
function classifyHue(h){
  if(h>=170 && h<=260) return 0; // azul
  if(h>=80 && h<170) return 1;   // verde
  if(h>=35 && h<80) return 2;    // amarelo
  if(h<=20 || h>=330) return 3;  // vermelho
  return -1;
}
const CLASS_COLORS = [
  [0,210,255],   // azul
  [60,255,180],  // verde
  [255,235,90],  // amarelo
  [255,80,60],   // vermelho
];

/* =========================
   STATE
========================= */
const state = {
  img: null,
  imgLoaded: false,
  pts: [],
  t: 0,
  anim: false
};

/* =========================
   IMAGE -> CANVAS (fit contain)
========================= */
function drawImageToCanvas(){
  const W = cnvImg.getBoundingClientRect().width;
  const H = cnvImg.getBoundingClientRect().height;
  ctxI.clearRect(0,0,W,H);

  ctxI.fillStyle = "#000";
  ctxI.fillRect(0,0,W,H);

  const img = state.img;
  const iw = img.naturalWidth, ih = img.naturalHeight;

  const scale = Math.min(W/iw, H/ih);
  const dw = iw*scale, dh = ih*scale;
  const dx = (W - dw)/2;
  const dy = (H - dh)/2;

  ctxI.imageSmoothingEnabled = true;
  ctxI.drawImage(img, dx, dy, dw, dh);

  ctxI.globalCompositeOperation = "screen";
  ctxI.fillStyle = "rgba(0,180,255,0.10)";
  ctxI.fillRect(0,0,W,H);
  ctxI.globalCompositeOperation = "source-over";
}

/* =========================
   EXTRACT POINTS
========================= */
function extractPointsFromCanvas(){
  const W = cnvImg.getBoundingClientRect().width;
  const H = cnvImg.getBoundingClientRect().height;
  const imgData = ctxI.getImageData(0,0,Math.max(1,Math.floor(W)),Math.max(1,Math.floor(H)));
  const d = imgData.data;

  const pts = [];
  const step = SAMPLE_STEP;

  for(let y=0; y<imgData.height; y+=step){
    for(let x=0; x<imgData.width; x+=step){
      const i = (y*imgData.width + x)*4;
      const r=d[i], g=d[i+1], b=d[i+2], a=d[i+3];

      if(a < MIN_ALPHA) continue;

      const [h,s,v] = rgbToHsv(r,g,b);
      if(v*255 < MIN_BRIGHT) continue;
      if(s < MIN_SAT) continue;

      const cls = classifyHue(h);
      if(cls === -1) continue;

      const keepChance = Math.min(0.9, 0.08 + v*0.55);
      if(Math.random() > keepChance) continue;

      pts.push({
        x, y,
        cls,
        ph: Math.random()*Math.PI*2,
        sp: 0.7 + Math.random()*1.4,
        base: 0.6 + Math.random()*0.9
      });

      if(pts.length >= MAX_POINTS) break;
    }
    if(pts.length >= MAX_POINTS) break;
  }
  state.pts = pts;
}

/* =========================
   ANIMATE POINTS
========================= */
function startAnim(){
  if(state.anim) return;
  state.anim = true;

  const loop = ()=>{
    const W = cnvPts.getBoundingClientRect().width;
    const H = cnvPts.getBoundingClientRect().height;
    ctxP.clearRect(0,0,W,H);
    ctxP.globalCompositeOperation = "lighter";

    // pontos base
    for(const p of state.pts){
      const [r,g,b] = CLASS_COLORS[p.cls];
      const pulse = 0.55 + 0.45*Math.sin(p.ph + state.t*p.sp*0.025);
      const alpha = 0.10 + 0.32*pulse;
      const rad   = 0.55 + p.base*0.70;

      ctxP.beginPath();
      ctxP.fillStyle = `rgba(${r},${g},${b},${alpha})`;
      ctxP.arc(p.x, p.y, rad, 0, Math.PI*2);
      ctxP.fill();
    }

    // brilho
    const glowCount = Math.min(2400, Math.max(650, (state.pts.length/14)|0));
    ctxP.save();
    ctxP.shadowBlur = 14;
    for(let i=0;i<glowCount;i++){
      const p = state.pts[(Math.random()*state.pts.length)|0];
      if(!p) continue;
      const [r,g,b] = CLASS_COLORS[p.cls];

      const pulse = 0.55 + 0.45*Math.sin(p.ph + state.t*0.03);
      const alpha = 0.06 + 0.20*pulse;

      ctxP.shadowColor = `rgba(${r},${g},${b},${0.70})`;
      ctxP.fillStyle   = `rgba(${r},${g},${b},${alpha})`;

      ctxP.beginPath();
      ctxP.arc(p.x, p.y, 1.3 + pulse*1.8, 0, Math.PI*2);
      ctxP.fill();
    }
    ctxP.restore();

    ctxP.globalCompositeOperation = "source-over";
    state.t++;
    requestAnimationFrame(loop);
  };
  loop();
}

/* =========================
   TELEMETRY (dummy wave)
========================= */
const wave = document.getElementById("wave");
const wctx = wave.getContext("2d");
let tWave=0;
function resizeWave(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  wave.width = Math.floor(wave.clientWidth * dpr);
  wave.height = Math.floor(wave.clientHeight * dpr);
  wctx.setTransform(dpr,0,0,dpr,0,0);
}
function startWave(){
  const draw = ()=>{
    const W = wave.clientWidth, H = wave.clientHeight;
    wctx.clearRect(0,0,W,H);
    wctx.fillStyle = "rgba(0,0,0,.25)";
    wctx.fillRect(0,0,W,H);

    wctx.strokeStyle = "rgba(110,210,255,.10)";
    wctx.lineWidth = 1;
    for(let y=12; y<H; y+=18){
      wctx.beginPath(); wctx.moveTo(0,y); wctx.lineTo(W,y); wctx.stroke();
    }

    wctx.lineWidth = 2;
    wctx.strokeStyle = "rgba(110,210,255,.90)";
    wctx.beginPath();
    for(let x=0;x<W;x++){
      const y = (H*0.52)
        + Math.sin((x+tWave)/38)*(H*0.20)
        + Math.sin((x+tWave)/13)*(H*0.07);
      if(x===0) wctx.moveTo(x,y); else wctx.lineTo(x,y);
    }
    wctx.stroke();

    tWave += 2;
    requestAnimationFrame(draw);
  };
  draw();
}

/* =========================
   MODAL: explicações
========================= */
const explanations = {
  "A": {
    title: "A — Estado",
    text:
`Condição ecológica atual do território.
• Integra sinais de vegetação, água e pressões.
• Quanto maior, mais íntegro o estado ambiental.`
  },
  "B": {
    title: "B — Tendência",
    text:
`Direção da mudança no tempo.
• Positivo: melhora / recuperação.
• Negativo: degradação / aumento de pressão.`
  },
  "C": {
    title: "C — Estabilidade",
    text:
`Resiliência e consistência do sistema.
• Alto: oscila pouco (mais estável).
• Baixo: oscila muito (mais instável).`
  },
  "R": {
    title: "Grau",
    text:
`Classificação sintética do desempenho do sistema.
• Converte os valores em uma faixa/nota para leitura rápida.`
  },
  "IBE": {
    title: "IBE — Índice Bioecológico",
    text:
`Integridade biológica/ecológica.
• Associado à cobertura vegetal e vitalidade do ecossistema.
• Quanto maior, mais “saudável” a base bioecológica.`
  },
  "IAB": {
    title: "IAB — Índice Abiótico",
    text:
`Fatores físicos do território.
• Solo, relevo, clima local e condições ambientais não-vivas.
• Ajuda a explicar limitações naturais do sistema.`
  },
  "IBI": {
    title: "IBI — Índice Biótico Integrado",
    text:
`Integração de sinais bióticos.
• Relações e “funcionamento” do sistema vivo como conjunto.
• Bom para comparar regiões com padrões ecológicos diferentes.`
  },
  "HID": {
    title: "HID — Indicador Hidrológico",
    text:
`Componentes de água e drenagem.
• Presença/condição de rios, corpos d’água e estrutura hídrica.
• Ajuda a monitorar alteração e conectividade hidrológica.`
  },
  "ENT": {
    title: "ENT — Entropia / Desordem Antrópica",
    text:
`Sinal de desorganização por pressão humana.
• Fragmentação, perturbação e ruído no sistema.
• Quanto maior, maior a pressão/desordem.`
  },
  "PAN": {
    title: "PAN — Pressão Antrópica Normalizada",
    text:
`Pressão humana padronizada.
• Índice comparável entre áreas.
• Quanto maior, maior impacto humano relativo.`
  }
};

const modal = document.getElementById("infoModal");
const titleEl = document.getElementById("infoTitle");
const contentEl = document.getElementById("infoContent");
const closeBtn = document.getElementById("closeInfo");

function openInfo(key){
  const data = explanations[key];
  if(!data) return;
  titleEl.textContent = data.title;
  contentEl.textContent = data.text;
  modal.style.display = "flex";
}

closeBtn.addEventListener("click", ()=> modal.style.display="none");
modal.addEventListener("click", (e)=>{ if(e.target === modal) modal.style.display="none"; });
window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") modal.style.display="none"; });

document.querySelectorAll("[data-key]").forEach(el=>{
  el.addEventListener("click", ()=> openInfo(el.getAttribute("data-key")));
});

/* =========================
   BOOT
========================= */
function boot(){
  resizeAll();
  startWave();

  const img = new Image();
  img.decoding = "async";
  img.src = IMG_URL + "?v=" + Date.now();
  img.onload = ()=>{
    state.img = img;
    state.imgLoaded = true;

    resizeAll();
    drawImageToCanvas();
    extractPointsFromCanvas();
    startAnim();
  };
}
boot();
</script>
</body>
</html>
