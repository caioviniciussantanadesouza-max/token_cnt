<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OS.CNT — Observatório CNT Amazônia</title>

  <style>
    :root{
      --c: rgba(120,220,255,.92);
      --c2: rgba(120,220,255,.28);
      --glass: rgba(4,18,32,.20);
      --glass2: rgba(4,18,32,.12);
      --stroke: rgba(120,220,255,.18);
      --text: #b9f1ff;
      --text2:#7fd6ff;
      --shadow: 0 0 14px rgba(120,220,255,.10), 0 0 40px rgba(0,255,255,.05);
      --r: 14px;
    }

    html,body{
      margin:0;
      height:100%;
      background:#01040a;
      color:var(--text);
      font-family:"Segoe UI", Arial, sans-serif;
      overflow:hidden;
    }

    /* ===== STAGE ===== */
    #stage{
      position:fixed; inset:0;
      background:#01040a;
    }

    /* IMAGEM BASE (protagonista) */
    #bg{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      transform: scale(1.02);
      animation: biome 12s ease-in-out infinite;
      filter: brightness(.92) contrast(1.08) saturate(1.06);
    }

    /* pulso/respiração ecológica (na imagem) */
    @keyframes biome{
      0%   { filter:brightness(.90) contrast(1.06) saturate(1.05); }
      50%  { filter:brightness(1.02) contrast(1.18) saturate(1.18); }
      100% { filter:brightness(.90) contrast(1.06) saturate(1.05); }
    }

    /* glow difuso por cima (não tapa a imagem) */
    #glow{
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 50% 55%, rgba(120,220,255,.12), transparent 55%),
        radial-gradient(circle at 65% 45%, rgba(120,220,255,.07), transparent 60%),
        radial-gradient(circle at 35% 35%, rgba(120,220,255,.05), transparent 65%);
      mix-blend-mode:screen;
      opacity:.9;
      animation: glow 10s ease-in-out infinite;
    }
    @keyframes glow{
      0%{ opacity:.75; }
      50%{ opacity:1; }
      100%{ opacity:.75; }
    }

    /* canvas de FX (fluxo/torres/partículas) */
    #fx{
      position:absolute; inset:0;
      width:100%; height:100%;
      pointer-events:none;
      mix-blend-mode:screen;
      filter: drop-shadow(0 0 8px rgba(120,220,255,.25));
      opacity:.95;
    }

    /* grade HUD bem sutil */
    #hudGrid{
      position:absolute; inset:0;
      pointer-events:none;
      background:
        linear-gradient(rgba(120,220,255,.045) 1px, transparent 1px),
        linear-gradient(90deg, rgba(120,220,255,.045) 1px, transparent 1px);
      background-size: 84px 84px;
      opacity:.12;
      mix-blend-mode:screen;
    }

    /* ===== PAINÉIS (bem leves) ===== */
    .glass{
      position:absolute;
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow:hidden;
    }

    /* deixar painéis mais “finos” e menos invasivos */
    .panel{
      padding:12px 12px 10px 12px;
      line-height:1.25;
      letter-spacing:.2px;
    }

    .title{
      font-weight:700;
      letter-spacing:1.2px;
      font-size:12px;
      color:var(--text2);
      opacity:.95;
    }
    .sub{ font-size:11px; opacity:.9; }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      letter-spacing:.35px;
    }
    .muted{ opacity:.78; }

    /* layout conforme seu modelo */
    #pLeft{ left:16px; top:16px; width:280px; }
    #pCenter{ left:50%; top:16px; transform:translateX(-50%); width:min(520px, 56vw); height:110px; }
    #pRight{ right:16px; top:16px; width:250px; }
    #pBottom{ left:16px; right:16px; bottom:14px; height:92px; display:flex; gap:12px; padding:12px; }

    /* CNT (não focar demais no número) */
    #cntVal{
      font-size:28px;
      font-weight:800;
      margin:6px 0 2px;
      color:#d9fbff;
      text-shadow: 0 0 18px rgba(120,220,255,.22);
      letter-spacing:1px;
    }
    #pulseTag{
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(120,220,255,.16);
      background:rgba(120,220,255,.05);
      font-size:11px;
      margin-top:8px;
    }

    /* indices compactos */
    .row{
      display:flex; justify-content:space-between; gap:10px;
      padding:5px 0;
      border-bottom:1px solid rgba(120,220,255,.10);
    }
    .row:last-child{ border-bottom:none; }
    .k{ font-size:12px; }
    .v{ font-size:12px; font-weight:700; color:#e5feff; }

    /* telemetria */
    #teleCanvas{
      width:100%; height:100%;
      filter: drop-shadow(0 0 10px rgba(120,220,255,.30));
    }
    #teleLabel{
      position:absolute; left:12px; top:8px;
      font-size:11px; opacity:.88;
    }

    /* bottom */
    .bCol{ flex:1; min-width:0; display:flex; flex-direction:column; justify-content:space-between; }
    .btns{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    button{
      cursor:pointer;
      border:1px solid rgba(120,220,255,.18);
      background:rgba(120,220,255,.06);
      color:#e8feff;
      border-radius:12px;
      padding:9px 12px;
      font-weight:700;
      letter-spacing:.3px;
    }
    button:hover{ background:rgba(120,220,255,.10); }
    input{
      width:100%;
      padding:9px 12px;
      border-radius:12px;
      border:1px solid rgba(120,220,255,.14);
      background:rgba(1,6,12,.30);
      color:#e8feff;
      outline:none;
    }
    #walletAddr{
      display:none;
      font-size:11px;
      opacity:.9;
      border:1px solid rgba(120,220,255,.14);
      background:rgba(120,220,255,.05);
      padding:6px 10px;
      border-radius:999px;
      max-width: 320px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    /* responsivo */
    @media (max-width: 820px){
      #pCenter{ display:none; }
      #pBottom{ height:112px; }
      #pRight{ width:235px; }
      #pLeft{ width:260px; }
    }
  </style>
</head>

<body>
  <div id="stage">
    <!-- SUA IMAGEM (sem mapa) -->
    <img id="bg" src="imagem_cnt.png" alt="CNT base" />

    <div id="glow"></div>
    <canvas id="fx"></canvas>
    <div id="hudGrid"></div>

    <!-- LEFT -->
    <div id="pLeft" class="glass">
      <div class="panel">
        <div class="title mono">OS.CNT</div>
        <div class="sub muted">Earth Environmental Monitoring Infrastructure</div>

        <div id="cntVal" class="mono">72.4</div>
        <div class="sub mono">
          Confiança: <b id="conf">Alta</b><br>
          Sistema: <b id="estado">Regulação estável</b><br>
          Modo: Monitoramento ativo
        </div>

        <div id="pulseTag" class="mono">PULSO • FLUXO</div>
      </div>
    </div>

    <!-- CENTER -->
    <div id="pCenter" class="glass">
      <div id="teleLabel" class="mono">Telemetria — oscilação funcional (30d)</div>
      <canvas id="teleCanvas"></canvas>
    </div>

    <!-- RIGHT -->
    <div id="pRight" class="glass">
      <div class="panel">
        <div class="title mono">SUB-ÍNDICES</div>
        <div class="sub muted">Significado embutido (científico)</div>
        <div id="idx"></div>
      </div>
    </div>

    <!-- BOTTOM -->
    <div id="pBottom" class="glass">
      <div class="bCol">
        <div class="title mono">TOKEN CNT (SOLANA)</div>
        <div class="sub">
          Cotação: <b class="mono" id="cntQuote">carregando…</b><br>
          Preço (USD): <b class="mono" id="cntUsd">—</b>
        </div>
        <div class="sub muted">Compra abre Pump.fun (assinatura na wallet)</div>
      </div>

      <div class="bCol">
        <div class="title mono">TROCA SOL → CNT</div>
        <input id="solIn" type="number" step="0.01" value="0.10" />
        <div class="sub">Você recebe aprox.: <b class="mono" id="cntOut">—</b></div>
      </div>

      <div class="bCol">
        <div class="title mono">CARTEIRA & ORDEM</div>
        <div class="btns">
          <button id="btnConnect">Conectar Wallet</button>
          <button id="btnBuy">Comprar</button>
          <span id="walletAddr" class="mono"></span>
        </div>
        <div class="sub muted mono">Rede: Solana</div>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * CONFIG
     ***********************/
    const MINT = "GCVyjNaCbXkwGUuktyNxSXad4ozmTp2fzQr2jieSpump";
    const PUMP_URL = "https://pump.fun/coin/GCVyjNaCbXkwGUuktyNxSXad4ozmTp2fzQr2jieSpump";

    /***********************
     * FX (fluxo/torres/partículas) — SEM MAPA
     ***********************/
    const fx = document.getElementById("fx");
    const fctx = fx.getContext("2d");
    function resizeFx(){
      fx.width = innerWidth * devicePixelRatio;
      fx.height = innerHeight * devicePixelRatio;
      fx.style.width = innerWidth + "px";
      fx.style.height = innerHeight + "px";
      fctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    addEventListener("resize", resizeFx);
    resizeFx();

    // torres (coloquei na área central para não “comer” painéis)
    const towers = Array.from({length: 26}, () => ({
      x: 0.18 + Math.random()*0.64,
      y: 0.18 + Math.random()*0.64,
      h: 0.35 + Math.random()*0.9,
      p: Math.random()*Math.PI*2,
      s: 0.6 + Math.random()*1.2
    }));

    const particles = Array.from({length: 140}, ()=>({
      x: Math.random(),
      y: Math.random(),
      r: 0.6 + Math.random()*1.6,
      v: 0.15 + Math.random()*0.65,
      p: Math.random()*Math.PI*2
    }));

    let T = 0;
    function drawFx(){
      const w = innerWidth, h = innerHeight;
      fctx.clearRect(0,0,w,h);

      const pulse = 0.55 + Math.sin(T*0.65)*0.13;

      // campo energético difuso
      const gx = w*0.52, gy = h*0.56;
      const rg = Math.min(w,h)*0.62;
      const grad = fctx.createRadialGradient(gx,gy,rg*0.05,gx,gy,rg);
      grad.addColorStop(0, `rgba(120,220,255,${0.10*pulse})`);
      grad.addColorStop(0.5, `rgba(120,220,255,${0.05*pulse})`);
      grad.addColorStop(1, "rgba(120,220,255,0)");
      fctx.fillStyle = grad;
      fctx.fillRect(0,0,w,h);

      // partículas
      fctx.globalCompositeOperation = "screen";
      for(const p of particles){
        p.p += 0.008*p.v;
        p.x += Math.cos(p.p)*0.00035*p.v;
        p.y += Math.sin(p.p)*0.00025*p.v;

        if(p.x<0) p.x=1; if(p.x>1) p.x=0;
        if(p.y<0) p.y=1; if(p.y>1) p.y=0;

        const px = p.x*w, py = p.y*h;
        fctx.beginPath();
        fctx.fillStyle = `rgba(120,220,255,${0.06*pulse})`;
        fctx.arc(px,py,p.r,0,Math.PI*2);
        fctx.fill();
      }

      // torres (atividade)
      for(const t of towers){
        const x = t.x*w;
        const y = t.y*h;
        const amp = (0.5 + Math.sin(T*1.25 + t.p)*0.5);
        const height = (18 + t.h*92) * (0.75 + amp*0.7);
        const width = 2.0 + amp*1.6;

        // halo base
        const hg = fctx.createRadialGradient(x,y,1,x,y,34);
        hg.addColorStop(0, `rgba(120,220,255,${0.22*pulse})`);
        hg.addColorStop(1, "rgba(120,220,255,0)");
        fctx.fillStyle = hg;
        fctx.beginPath();
        fctx.arc(x,y,34,0,Math.PI*2);
        fctx.fill();

        // coluna
        const lg = fctx.createLinearGradient(x,y-height,x,y);
        lg.addColorStop(0, `rgba(120,220,255,0)`);
        lg.addColorStop(0.25, `rgba(120,220,255,${0.09*pulse})`);
        lg.addColorStop(0.75, `rgba(120,220,255,${0.20*pulse})`);
        lg.addColorStop(1, `rgba(120,220,255,${0.10*pulse})`);
        fctx.fillStyle = lg;
        fctx.fillRect(x-width/2, y-height, width, height);

        // topo
        fctx.fillStyle = `rgba(180,255,255,${0.16*pulse})`;
        fctx.beginPath();
        fctx.arc(x, y-height, 4 + amp*2, 0, Math.PI*2);
        fctx.fill();
      }

      fctx.globalCompositeOperation = "source-over";

      // vinheta sutil (pra parecer “terminal”)
      const vg = fctx.createRadialGradient(w/2,h/2,Math.min(w,h)*0.35,w/2,h/2,Math.min(w,h)*0.92);
      vg.addColorStop(0,"rgba(0,0,0,0)");
      vg.addColorStop(1,"rgba(0,0,0,0.45)");
      fctx.fillStyle = vg;
      fctx.fillRect(0,0,w,h);

      T += 0.016;
      requestAnimationFrame(drawFx);
    }
    drawFx();

    /***********************
     * TELEMETRIA
     ***********************/
    const tele = document.getElementById("teleCanvas");
    const tctx = tele.getContext("2d");
    function resizeTele(){
      const box = tele.getBoundingClientRect();
      tele.width = Math.floor(box.width * devicePixelRatio);
      tele.height = Math.floor(box.height * devicePixelRatio);
      tctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    addEventListener("resize", resizeTele);
    resizeTele();

    let shift = 0;
    function drawTele(){
      const w = tele.getBoundingClientRect().width;
      const h = tele.getBoundingClientRect().height;

      tctx.clearRect(0,0,w,h);
      tctx.fillStyle = "rgba(0,20,40,.18)";
      tctx.fillRect(0,0,w,h);

      tctx.lineWidth = 2;
      tctx.strokeStyle = "rgba(120,220,255,.92)";
      tctx.beginPath();
      for(let i=0;i<w;i++){
        const a = (i+shift)/42;
        const b = (i+shift)/13;
        const c = (i+shift)/90;
        const y = h*0.60
          + Math.sin(a)*h*0.10
          + Math.sin(b)*h*0.04
          + Math.sin(c)*h*0.06;
        if(i===0) tctx.moveTo(i,y);
        else tctx.lineTo(i,y);
      }
      tctx.stroke();

      shift += 2;
      requestAnimationFrame(drawTele);
    }
    drawTele();

    /***********************
     * ÍNDICES + SIGNIFICADO (embutido)
     ***********************/
    const idxBox = document.getElementById("idx");
    const cntValEl = document.getElementById("cntVal");
    const confEl = document.getElementById("conf");
    const estadoEl = document.getElementById("estado");

    const defs = [
      { key:"IBE", name:"Bioelétrico", v:88 },
      { key:"IAB", name:"Abiótico",    v:88 },
      { key:"IBI", name:"Biótico",     v:11 },
      { key:"HID", name:"Hídrico",     v:83 },
      { key:"ENT", name:"Entropia",    v:88 },
      { key:"PAN", name:"Antrópico",   v:78 }
    ];

    function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

    function renderIndices(){
      idxBox.innerHTML = "";
      defs.forEach(d=>{
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `
          <div class="k mono">${d.key} <span class="muted">(${d.name})</span></div>
          <div class="v mono">${d.v.toFixed(0)}</div>
        `;
        idxBox.appendChild(row);
      });
    }

    let tSim = 0;
    function tick(){
      tSim += 0.016;
      const w1 = Math.sin(tSim*0.35);
      const w2 = Math.sin(tSim*0.18 + 1.2);
      const w3 = Math.sin(tSim*0.24 + 2.0);

      const HID = clamp(80 + w2*8 + w3*4, 0, 100);
      const IBI = clamp(22 + w1*7 + w2*4, 0, 100);
      const IAB = clamp(86 + w3*6, 0, 100);
      const IBE = clamp(84 + w1*6 + w3*3, 0, 100);

      const PAN = clamp(72 + (-w2)*7 + (w1)*5, 0, 100);
      const ENT = clamp(78 + (PAN-70)*0.35 + (-IBI)*0.05 + w3*3, 0, 100);

      defs.find(x=>x.key==="HID").v = HID;
      defs.find(x=>x.key==="IBI").v = IBI;
      defs.find(x=>x.key==="IAB").v = IAB;
      defs.find(x=>x.key==="IBE").v = IBE;
      defs.find(x=>x.key==="PAN").v = PAN;
      defs.find(x=>x.key==="ENT").v = ENT;

      const base = (IBE*0.22 + IAB*0.20 + IBI*0.18 + HID*0.20);
      const pen  = (ENT*0.10 + PAN*0.10);
      const CNT  = clamp(base - (pen-12), 0, 100);

      cntValEl.textContent = CNT.toFixed(1);

      let conf = "Alta";
      if(CNT < 55) conf = "Média";
      if(CNT < 40) conf = "Baixa";
      confEl.textContent = conf;

      let estado = "Regulação estável";
      if(CNT < 58) estado = "Transição funcional";
      if(CNT < 42) estado = "Estresse sistêmico";
      estadoEl.textContent = estado;

      renderIndices();
      requestAnimationFrame(tick);
    }
    renderIndices();
    tick();

    /***********************
     * COTAÇÃO REAL DO TOKEN (DexScreener)
     ***********************/
    const cntQuote = document.getElementById("cntQuote");
    const cntUsd = document.getElementById("cntUsd");
    const solIn = document.getElementById("solIn");
    const cntOut = document.getElementById("cntOut");

    let cntPerSol = 0;
    let priceSol = 0;
    let priceUSD = 0;

    function updateQuote(){
      const sol = parseFloat(solIn.value || "0");
      if(!cntPerSol || !isFinite(cntPerSol)){
        cntOut.textContent = "—";
        return;
      }
      const out = sol * cntPerSol;
      cntOut.textContent = out.toLocaleString("pt-BR",{maximumFractionDigits:0}) + " CNT";
    }
    solIn.addEventListener("input", updateQuote);

    async function atualizarPrecoCNT(){
      try{
        const r = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${MINT}`);
        const data = await r.json();

        if(!data.pairs || data.pairs.length === 0){
          cntQuote.textContent = "sem liquidez";
          cntUsd.textContent = "—";
          cntPerSol = 0;
          updateQuote();
          return;
        }

        const pair = data.pairs[0];
        priceSol = parseFloat(pair.priceNative);
        priceUSD = parseFloat(pair.priceUsd || "0");

        if(!priceSol || !isFinite(priceSol)){
          cntQuote.textContent = "indisponível";
          cntUsd.textContent = "—";
          cntPerSol = 0;
          updateQuote();
          return;
        }

        cntPerSol = 1 / priceSol;

        cntQuote.textContent =
          `1 SOL ≈ ${cntPerSol.toLocaleString("pt-BR",{maximumFractionDigits:0})} CNT`;

        cntUsd.textContent =
          (priceUSD && isFinite(priceUSD))
            ? `$ ${priceUSD.toFixed(8)}`
            : "—";

        updateQuote();
      }catch(e){
        cntQuote.textContent = "carregando…";
        cntUsd.textContent = "—";
      }
    }
    atualizarPrecoCNT();
    setInterval(atualizarPrecoCNT, 20000);

    /***********************
     * WALLET SOLANA (injetada) + COMPRA
     ***********************/
    const btnConnect = document.getElementById("btnConnect");
    const btnBuy = document.getElementById("btnBuy");
    const walletAddr = document.getElementById("walletAddr");

    function getProvider(){
      if(window.solana && window.solana.isPhantom) return window.solana;
      if(window.solflare && window.solflare.isSolflare) return window.solflare;
      if(window.solana) return window.solana;
      return null;
    }
    function shortAddr(a){ return a.slice(0,4) + "…" + a.slice(-4); }

    btnConnect.addEventListener("click", async ()=>{
      const provider = getProvider();
      if(!provider){
        alert("Nenhuma wallet Solana detectada. Instale Phantom ou Solflare e recarregue.");
        return;
      }
      try{
        const res = await provider.connect();
        const pub = (res && res.publicKey) ? res.publicKey.toString() : (provider.publicKey ? provider.publicKey.toString() : "");
        if(pub){
          walletAddr.style.display = "";
          walletAddr.textContent = shortAddr(pub);
        }
      }catch(e){}
    });

    btnBuy.addEventListener("click", ()=>{
      window.open(PUMP_URL, "_blank", "noopener,noreferrer");
    });
  </script>
</body>
</html>
